@import '~@angular/material/theming';
@include mat-core();

@import 'app-common.scss';
@import 'app-externals.scss';
@import 'dragular.scss';
@import 'app-ngx-charts-dark.scss';
@import 'app-scrollbars.scss';

@import 'app/modules/core/components/bd-button-popup/bd-button-popup-theme.scss';
@import 'app/modules/core/components/bd-image-upload/bd-image-upload-theme.scss';
@import 'app/modules/core/components/bd-form-toggle/bd-form-toggle-theme.scss';

@import 'app/modules/admin/components/hive/hive-theme.scss';
@import 'app/modules/admin/components/admin-shell/admin-shell.theme.scss';
@import 'app/modules/admin/components/audit-log/audit-log-theme.scss';

@import 'app/modules/legacy/core/legacy-themes.scss';

@mixin all-themes($theme) {
  @include angular-material-theme($theme);
  @include common-classes($theme);
  @include bd-button-popup-theme($theme);
  @include bd-image-upload-theme($theme);
  @include bd-form-toggle-theme($theme);

  @include hive-theme($theme);
  @include audit-log-theme($theme);
  @include settings-shell-theme($theme);

  // TODO: remove legacy
  @include legacy-themes($theme);

  $dark: map-get($theme, 'is-dark');

  // general element themings
  .mat-badge-content {
    background-color: rgb(194, 194, 194);
    color: black;
  }
  .mat-row:hover,
  .mat-card:hover {
    background-color: if($dark, #3e3e3e, #fafafa);
    transition: background-color 0.2s ease;
  }

  .mat-row-route-active,
  .mat-card-route-active {
    background-color: if($dark, #525252, #dfdfdf);
  }

  .mat-row-route-active:hover,
  .mat-card-route-active:hover {
    background-color: if($dark, #575757, #d8d8d8);
  }

  a {
    color: if($dark, mat-color($mat-blue, 300), mat-color($mat-blue, 800));
  }

  // Define scrollbar style on each element as it is not inherited in some cases.
  * {
    @include scrollbars(mat-color(map-get($theme, 'primary')), if($dark, #555555, #cccccc));
  }

  // Pseudo selector to define variables on the main theme class.
  & {
    $primary: map-get($theme, 'primary');
    $accent: map-get($theme, 'accent');
    $warn: map-get($theme, 'warn');
    $bg: map-get($theme, 'background');
    $fg: map-get($theme, 'foreground');
    $maintb: map-get($theme, 'main-toolbar');

    --bd-primary: #{mat-color($primary)};
    --bd-accent: #{mat-color($accent)};
    --bd-warn: #{mat-color($warn)};
    --bd-main-bar: #{mat-color($maintb)};

    --bd-text: #{mat-color($fg, 'text')};
    --bd-text-secondary: #{mat-color($fg, 'secondary-text')};

    --bd-bg-dialog: #{mat-color($bg, 'dialog')};
    --bd-bg-toolbar: #{mat-color($bg, 'app-bar')};

    --bd-primary-darker: #{mat-color($primary, 'darker')};
    --bd-accent-darker: #{mat-color($accent, 'darker')};
    --bd-warn-darker: #{mat-color($warn, 'darker')};
    --bd-main-bar-darker: #{mat-color($maintb, 900)};

    --bd-primary-contrast: #{mat-color($primary, 'default-contrast')};
    --bd-accent-contrast: #{mat-color($accent, 'default-contrast')};
    --bd-warn-contrast: #{mat-color($warn, 'default-contrast')};
    --bd-main-bar-contrast: #{mat-color($maintb, 'default-contrast')};
  }

  .inline-code {
    font-family: monospace;
    padding: 2px 4px;
    color: if($dark, white, black);
    background-color: if($dark, #333333, #eeeeee);
    border-radius: 3px;
  }
}

@mixin theme-chooser($theme) {
  $theme-bg: map-get($theme, 'background');
  $theme-primary: mat-color(map-get($theme, 'primary'));
  $theme-accent: mat-color(map-get($theme, 'accent'));
  $theme-main-tb: mat-color(map-get($theme, 'main-toolbar'));

  .preview-background {
    cursor: pointer;
    display: block;
    position: relative;
    margin: 3px;
    width: 56px;
    height: 56px;
    box-sizing: border-box;
    border-radius: 4px;
    background-color: map-get($theme-bg, 'background');
  }

  .preview-accent {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    position: absolute;
    right: 4px;
    bottom: 4px;
    background-color: $theme-accent;
  }

  .preview-selected {
    width: 24px;
    height: 24px;
    position: absolute;
    right: 5px;
    top: 5px;
    color: $theme-accent;
  }

  .preview-circle {
    position: absolute;
    top: 9px;
    right: 9px;
    width: 34px;
    height: 34px;
    border-radius: 25%;
    background: linear-gradient(to right, $theme-main-tb 0%, $theme-main-tb 50%, $theme-primary 51%, $theme-primary 100%);
  }
}

/* Theme definitions - keep in sync with ThemeService.Theme */
@function add-toolbar-color($theme, $toolbar-palette) {
  @return map-merge(
    $theme,
    (
      'main-toolbar': $toolbar-palette,
    )
  );
}

@function override-theme-background($theme, $key, $value) {
  $bg: map-get($theme, background);
  $bg: map-merge(
    $bg,
    (
      $key: $value,
    )
  );
  @return map-merge(
    $theme,
    (
      background: $bg,
    )
  );
}

/* "proper" yellow */
$app-yellow-def: (
  50: #fffee8,
  100: #fbf315,
  200: #fbf315,
  300: #fbf315,
  400: #fbf315,
  500: #fbf315,
  600: #fbf315,
  700: #cfc912,
  800: #cfc912,
  900: #cfc912,
  A100: #fbf315,
  A200: #fbf315,
  A400: #fbf315,
  A700: #fbf315,
  contrast: (
    50: $dark-primary-text,
    100: $dark-primary-text,
    200: $dark-primary-text,
    300: $dark-primary-text,
    400: $dark-primary-text,
    500: $dark-primary-text,
    600: $dark-primary-text,
    700: $dark-primary-text,
    800: $dark-primary-text,
    900: $dark-primary-text,
    A100: $dark-primary-text,
    A200: $dark-primary-text,
    A400: $dark-primary-text,
    A700: $dark-primary-text,
  ),
);
$app-yellow-palette: mat-palette($app-yellow-def);

/* light theme - default */
$app-light-primary: mat-palette($mat-indigo, 500);
$app-light-accent: mat-palette($mat-pink, A200);
$app-light-warning: mat-palette($mat-orange, A700);
$app-light-theme: add-toolbar-color(mat-light-theme($app-light-primary, $app-light-accent, $app-light-warning), $app-light-primary);
.app-light-theme {
  @include all-themes($app-light-theme);
}
.app-light-theme-chooser {
  @include theme-chooser($app-light-theme);
}

/* light theme with yellow toolbar */
$app-light-yellow-primary: mat-palette($mat-grey, 700);
$app-light-yellow-accent: mat-palette($mat-red);
$app-light-yellow-warning: mat-palette($mat-orange);
$app-light-yellow-theme: add-toolbar-color(
  mat-light-theme($app-light-yellow-primary, $app-light-yellow-accent, $app-light-yellow-warning),
  $app-yellow-palette
);
.app-light-yellow-theme {
  @include all-themes($app-light-yellow-theme);
}
.app-light-yellow-theme-chooser {
  @include theme-chooser($app-light-yellow-theme);
}

/* dark blue theme */
$app-dark-primary: mat-palette($mat-indigo, 200);
$app-dark-accent: $app-yellow-palette;
$app-dark-warning: mat-palette($mat-deep-orange);
$app-dark-theme: add-toolbar-color(mat-dark-theme($app-dark-primary, $app-dark-accent, $app-dark-warning), mat-palette($mat-indigo, 500));
$app-dark-theme: override-theme-background($app-dark-theme, app-bar, #3d3c3e);
.app-dark-theme {
  @include all-themes($app-dark-theme);
  @include ngx-charts-dark();
}
.app-dark-theme-chooser {
  @include theme-chooser($app-dark-theme);
}

/* dark yellow theme */
$app-dark-yellow-primary: $app-yellow-palette;
$app-dark-yellow-accent: mat-palette($mat-blue, 700);
$app-dark-yellow-warning: mat-palette($mat-deep-orange);
$app-dark-yellow-theme: add-toolbar-color(mat-dark-theme($app-dark-yellow-primary, $app-dark-yellow-accent, $app-dark-yellow-warning), $app-yellow-palette);
$app-dark-yellow-theme: override-theme-background($app-dark-yellow-theme, app-bar, #3d3c3e);
.app-dark-yellow-theme {
  @include all-themes($app-dark-yellow-theme);
  @include ngx-charts-dark();
}
.app-dark-yellow-theme-chooser {
  @include theme-chooser($app-dark-yellow-theme);
}

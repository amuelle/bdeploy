<mat-menu #appMenu="matMenu" xPosition="before" class="bd-offset-top5px">
  <div
    mat-menu-item
    disabled="true"
    class="local-title-box"
    fxLayout="row"
    fxLayoutAlign="flex-start center"
    fxLayoutGap="16px"
  >
    <app-user-avatar
      [gravatar]="!settings.isLoading() && settings.getSettings().general.enableGravatar"
      [mail]="user?.email"
      hostSize="24"
      avatarSize="24"
    ></app-user-avatar>
    <div>{{ getTitleUserName() }}</div>
  </div>
  <button mat-menu-item (click)="edit()" [disabled]="user?.external"><mat-icon>edit</mat-icon>Edit...</button>
  <button mat-menu-item (click)="changePassword()" [disabled]="user?.external">
    <mat-icon>fingerprint</mat-icon>Change Password...
  </button>
  <button mat-menu-item (click)="openDialog(tokenDialog)"><mat-icon>vpn_key</mat-icon>Create Token...</button>
  <button mat-menu-item (click)="logout()"><mat-icon>exit_to_app</mat-icon>Logout</button>
</mat-menu>

<app-bd-button class="local-info-button" [matMenuTriggerFor]="appMenu" [inverseColor]="true">
  <app-user-avatar
    [gravatar]="!settings.isLoading() && settings.getSettings().general.enableGravatar"
    [mail]="user?.email"
    [hostSize]="36"
  ></app-user-avatar>
</app-bd-button>

<ng-template #tokenDialog>
  <h1 mat-dialog-title>Token for {{ user.name }}</h1>
  <p>
    Use the following token to remotely access this server in your name, e.g. for pushing products. To do so, copy the
    complete content to the according tool.
  </p>
  <p>
    <mat-slide-toggle [(ngModel)]="genFull" (change)="regenPack()"
      >Generate full token pack including certificate</mat-slide-toggle
    >
  </p>
  <p>
    A full token pack is typically required by the CLI, build tools, etc. A slim token is required to perform HTTPS
    communication with the BDeploy server.
  </p>
  <p>
    <strong>Attention:</strong> This token is sensitive information as it allows remote access under your name. Do not
    pass this token on to others.
  </p>
  <div fxLayout="column">
    <textarea #inputTarget readonly class="local-large-text" fxFlex="1 0 auto">{{ pack }}</textarea>
  </div>
  <div mat-dialog-actions>
    <button mat-raised-button [ngxClipboard]="inputTarget" (cbOnSuccess)="copied()" color="primary">
      Copy To Clipboard
    </button>
    <button mat-raised-button [mat-dialog-close]="true">Close</button>
  </div>
</ng-template>

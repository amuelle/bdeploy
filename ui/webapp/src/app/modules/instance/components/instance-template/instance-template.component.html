<ng-template #dialog>
  <h1 mat-dialog-title>Configure from Instance Template</h1>
  <div mat-dialog-content class='flex-content'>
    <mat-horizontal-stepper #stepper [linear]='true'>
      <mat-step label='Template Selection' [completed]='selectedTemplate'>
        <div>
          <div class='center-toggles'>
            <mat-button-toggle-group (change)='updateSelection($event)'>
              <mat-button-toggle class='toggle' *ngFor='let tpl of allTemplates; let i = index' [value]='i'>
                <div class='toggle-content'>
                  <div><strong>{{tpl.name}}</strong></div>
                  <div class='description'>{{tpl.description}}</div>
                </div>
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
          <div *ngIf='selectedTemplate'>
            <div class='hintText'>Please select a mapping from nodes defined in the template to nodes available on your system. Applications will be created on the selected nodes. The same node may be selected more than once to create application from multiple template-defined nodes on a single available node.</div>
            <div *ngFor='let node of selectedTemplate.nodes; let nodeIndex = index' class='node-mapping'>
              <span>{{node.name}}</span>
              <div class='spacer'></div>
              <app-instance-template-node-detail [node]='node' [product]='product' [config]='config'></app-instance-template-node-detail>
              <mat-select [(value)]='nodeMappings[nodeIndex]' class='node-select'>
                <mat-option value='__none'>None (don't create)</mat-option>
                <mat-option *ngFor='let physNode of getNodesForType(node)' [value]='physNode'>{{getNiceName(physNode)}}</mat-option>
              </mat-select>
            </div>
          </div>
        </div>
        <div mat-dialog-actions align="end">
          <button mat-raised-button type="button" (click)='dialogRef.close()'>Cancel</button>
          <button mat-raised-button type="button" color="primary" (click)='stepper.next()' [disabled]='!selectedTemplate'>Next</button>
        </div>
      </mat-step>
      <mat-step label='Variables'>
        <form #varForm="ngForm">
          <ng-template #noVarHint>
            <div>No variables are required by the template, press <strong>Next</strong> to continue.</div>
          </ng-template>
          <div *ngIf='selectedTemplate?.variables?.length; else noVarHint' class='variable-fields'>
            <mat-form-field *ngFor='let variable of selectedTemplate.variables'>
              <input matInput type='text' [name]='variable.uid' [id]='variable.uid' required [(ngModel)]='variables[variable.uid]' [placeholder]='variable.name' [matTooltip]='variable.description'>
            </mat-form-field>
          </div>
          <div mat-dialog-actions align="end">
            <button mat-raised-button type="button" (click)='dialogRef.close()'>Cancel</button>
            <button mat-raised-button type="button" (click)='stepper.previous()'>Back</button>
            <button mat-raised-button type="button" (click)='stepper.next(); applyTemplate();' color="primary" [disabled]='varForm.invalid'>Next</button>
          </div>
        </form>
      </mat-step>
      <mat-step label='Applying'>
        <div *ngIf='statusText' class='status'><mat-spinner [diameter]='24'></mat-spinner>{{statusText}}</div>
        <div *ngIf='!statusText'>Done.</div>
        <div mat-dialog-actions align="end">
          <button mat-raised-button type="submit" color="primary" (click)='dialogRef.close()' [disabled]='statusText'>Close</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</ng-template>

<mat-card [ngClass]="getCardStyle()" matRipple attr.data-cy='{{isActive ? "active" : "" }}'>
  <div class="flex-row">
    <div class='header-icon'>
        <mat-progress-spinner *ngIf="isLoading" diameter="24" color="accent" mode="indeterminate"></mat-progress-spinner>
        <ng-container *ngIf="!isLoading">
          <mat-icon class='icon-margin' *ngIf="isActive" matTooltip="Installed and active">check_circle</mat-icon>
          <mat-icon class='icon-margin' *ngIf="isDeployed" matTooltip="Installed">check_circle_outline</mat-icon>
        </ng-container>
    </div>
    <div class="mat-title title">{{ instanceVersionDto.product.tag }}</div>
    <span class="spacer"></span>
    <span *ngIf="!productAvailable" class="product-unavailable" matTooltip="Required product version is not available.">N/A</span>
    <mat-menu #appMenu="matMenu" xPosition="before">
      <button mat-menu-item (click)="install.emit(instanceVersionDto.key)" [disabled]='dirty || !productAvailable || isDeployed || isActive'>Install</button>
      <button mat-menu-item (click)="uninstall.emit(instanceVersionDto.key)" [disabled]='dirty || !isDeployed || isActive || isRunningOrScheduled'>Uninstall</button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="activate.emit(instanceVersionDto.key)" [disabled]='dirty || !productAvailable || !isDeployed'>Activate</button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="export.emit(instanceVersionDto.key)">Export...</button>
    </mat-menu>
    <button class="option-button" mat-icon-button [matMenuTriggerFor]="appMenu" appClickStopPropagation>
      <mat-icon>more_vert</mat-icon>
    </button>
  </div>
  <div class="content-row">
    <div class="description" *ngIf="!dirty">[Version {{ instanceVersionDto.key.tag }}]</div>
    <div class="description" *ngIf="dirty">[Locally Modified]</div>
    <app-instance-version-history-card class='show-on-hover' *ngIf='!dirty' [instanceVersionDto]='instanceVersionDto' [instanceGroup]='instanceGroup' [instanceUuid]='instanceUuid' appClickStopPropagation></app-instance-version-history-card>
    <span class="spacer"></span>
    <div *ngIf="!dirty" class='icons'>
      <app-process-status [instanceTag]="instanceVersionDto.key.tag" [activatedTag]="state.activeTag" [outOfSyncIcon]="true"></app-process-status>
    </div>
  </div>
</mat-card>

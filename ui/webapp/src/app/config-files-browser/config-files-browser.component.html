<div class="box">
  <mat-toolbar class="mat-elevation-z1 header-toolbar">
    <button mat-icon-button type="button" (click)='location.back()'><mat-icon>chevron_left</mat-icon></button>
    <span>Configuration Files</span>
    <span class="fill-space"></span>
    <app-remote-progress [scope]='[groupParam]'></app-remote-progress>
    <button mat-button (click)="onDiscardChanges()" [disabled]="!isDirty() || editMode">DISCARD</button>
    <button mat-raised-button color="primary" type="submit" [disabled]="!isDirty() || editMode" (click)="onSave()">SAVE</button>
  </mat-toolbar>

  <!-- file listing -->
  <mat-card *ngIf="!editMode" class="config-card">
    <mat-card-content class="config-card-content">
      <table mat-table class="filelist-table" [dataSource]="listConfigFiles()" #filetable>

        <ng-container matColumnDef="icon">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let path" class="icon-column"><mat-icon>subject</mat-icon></td>
        </ng-container>

        <ng-container matColumnDef="path">
          <th mat-header-cell *matHeaderCellDef>Configuration file path</th>
          <td mat-cell *matCellDef="let path" class="wide-column"><span [ngClass]="{'deletedFile': isDeleted(path)}">{{ path }}</span><span class="modifiedFile">{{ getStatus(path) }}</span></td>
        </ng-container>

        <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef>Del.</th>
          <td mat-cell *matCellDef="let path" class="icon-column">
            <button mat-icon-button *ngIf="!isDeleted(path)" (click)="deleteFile(path); filetable.renderRows()" matTooltip="Delete File"><mat-icon>delete</mat-icon></button>
            <button mat-icon-button *ngIf="isDeleted(path)" (click)="restoreFile(path); filetable.renderRows()" matTooltip="Restore File"><mat-icon >undo</mat-icon></button>
          </td>
        </ng-container>

        <ng-container matColumnDef="copy">
          <th mat-header-cell *matHeaderCellDef>Copy</th>
          <td mat-cell *matCellDef="let path">
            <button mat-icon-button *ngIf="!isDeleted(path)" (click)="editFile(path, true); filetable.renderRows()" matTooltip="Copy and Edit File"><mat-icon>file_copy</mat-icon></button>
          </td>
        </ng-container>

        <ng-container matColumnDef="edit">
          <th mat-header-cell *matHeaderCellDef>Edit</th>
          <td mat-cell *matCellDef="let path" class="icon-column" >
            <button mat-icon-button *ngIf="!isDeleted(path)" (click)="editFile(path, false); filetable.renderRows()" matTooltip="Edit File"><mat-icon>edit</mat-icon></button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef='displayedColumns'></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      </table>
    </mat-card-content>
  </mat-card>

  <!-- file editor -->
  <mat-card *ngIf="editMode" class="config-card">
    <form [formGroup]="configFileFormGroup" (ngSubmit)="onApplyChanges()" class="config-card-form">
      <mat-card-header>
        <div mat-card-avatar><mat-icon class="config-title-icon">subject</mat-icon></div>
        <mat-card-title class='edit-card-title'>{{ editKey ? editKey : 'New File' }}</mat-card-title>
        <span class="fill-space"></span>
        <span>
          <button mat-button type="button" (click)="onCancelChanges()">CANCEL</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!isEditorDirty()">APPLY</button>
        </span>
      </mat-card-header>
      <mat-card-content class="config-card-content">
        <mat-form-field class="path-field">
          <input class="input-field" matInput formControlName="path" placeholder="Enter path for file" />
          <mat-error *ngIf="pathControl.invalid">{{getErrorMessage(pathControl)}}</mat-error>
        </mat-form-field>
        <ace-editor class="ace-editor" [(text)]="editorContent" [theme]="editorTheme" [mode]="editorMode"></ace-editor>
      </mat-card-content>
    </form>
  </mat-card>

  <a mat-fab class="add-button" (click)="addFile()">
    <mat-icon>add</mat-icon>
  </a>
</div>

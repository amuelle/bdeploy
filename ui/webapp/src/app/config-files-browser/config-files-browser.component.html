<div class="box">
  <mat-toolbar class="mat-elevation-z1 header-toolbar">
    <button mat-icon-button type="button" (click)='location.back()'><mat-icon>chevron_left</mat-icon></button>
    <span>Configuration Files</span>
    <span class="fill-space"></span>
    <app-remote-progress [scope]='[groupParam]'></app-remote-progress>
    <button mat-raised-button color="primary" type="submit" [disabled]="!isDirty() || editMode" (click)="onSave()">SAVE</button>
  </mat-toolbar>

  <!-- file listing -->
  <mat-card *ngIf="!editMode" class="config-card">
    <mat-card-header>
      <div mat-card-avatar><mat-icon class="config-title-icon">folder</mat-icon></div>
      <mat-card-title>{{ instanceVersion?.name }}</mat-card-title>
      <mat-card-subtitle>{{ instanceVersion?.description}}</mat-card-subtitle>
      <span class="fill-space"></span>
      <mat-icon class="config-title-icon" (click)="addFile()">add_circle</mat-icon>
    </mat-card-header>
    <mat-card-content>
      <table mat-table class="filelist-table" [dataSource]="listConfigFiles()" #filetable>

        <ng-container matColumnDef="icon">
          <th mat-header-cell *matHeaderCellDef>icon</th>
          <td mat-cell *matCellDef="let path" class="icon-column"><mat-icon (click)="editFile(path); filetable.renderRows()">view_headline</mat-icon></td>
        </ng-container>

        <ng-container matColumnDef="path">
          <th mat-header-cell *matHeaderCellDef>path</th>
          <td mat-cell *matCellDef="let path" class="wide-column"><span [ngClass]="{'deletedFile': isDeleted(path)}">{{ path }}</span></td>
        </ng-container>

        <ng-container matColumnDef="delete">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let path" align="right" class="icon-column">
            <mat-icon *ngIf="!isDeleted(path)" class="icon-button" (click)="deleteFile(path); filetable.renderRows()">delete</mat-icon>
            <mat-icon *ngIf="isDeleted(path)" class="icon-button" (click)="restoreFile(path); filetable.renderRows()">undo</mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="copy">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let path" align="right" class="icon-column" (click)="editFile(path, true); filetable.renderRows()">
            <mat-icon *ngIf="!isDeleted(path)" class="icon-button">file_copy</mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="edit">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let path" align="right" class="icon-column" (click)="editFile(path, false); filetable.renderRows()">
            <mat-icon *ngIf="!isDeleted(path)" class="icon-button">edit</mat-icon>
          </td>
        </ng-container>

        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      </table>
    </mat-card-content>
  </mat-card>

  <!-- file editor -->
  <mat-card *ngIf="editMode" class="config-card">
    <form [formGroup]="configFileFormGroup" (ngSubmit)="onApplyChanges()">
      <mat-card-header>
        <div mat-card-avatar><mat-icon class="config-title-icon">view_headline</mat-icon></div>
        <mat-card-title>{{ editKey ? editKey : 'New File' }}</mat-card-title>
        <span class="fill-space"></span>
        <span>
          <button mat-button type="button" (click)="onCancelChanges()">CANCEL</button>
          <button mat-raised-button color="primary" type="submit" [disabled]="!configFileFormGroup.valid">APPLY</button>
        </span>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field class="path-field">
          <input class="input-field" matInput formControlName="path" placeholder="New Path" />
          <mat-error *ngIf="pathControl.invalid">{{getErrorMessage(pathControl)}}</mat-error>
        </mat-form-field>
        <mat-form-field class="content-field">
          <textarea matInput formControlName="content" placeholder="Content" rows="20"></textarea>
        </mat-form-field>
      </mat-card-content>
    </form>
  </mat-card>
</div>

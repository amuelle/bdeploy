=== Instance Configuration

The *Instance Overview* page is the central dialog for configuring and managing instances. The first step is to select the required applications from the *Configure Applications* panel available in the *Product Version* and distribute them to the *Nodes* in the *Instance* using drag and drop.

The *Configure Applications* panel is called up via the pull-down menu of the dialog.

image::images/BDeploy_Instance_Menu.png[Instance Menu,align=center, width=480, link="images/BDeploy_Instance_Menu.png"]

The *Configure Applications* panel contains all server applications and all client applications of the product. Server applications can be dragged to *Server Nodes* (e.g. _master_), client applications can only be dragged to the (virtual) *Client Applications Node*. Clients that are available for more than one operating system expand to single cards per operating system on the *Client Node*.

[NOTE]
The *Client Application Node* is not available if the product does not contain any client applications.

==== Process Settings

Each *Process* of an *Instance* is configured via its own dialog, which can be accessed via the pull-down menu on the respective *Process Card*.
Colored markings on the *Process Card* indicate whether a process still lacks mandatory configurations or whether there are still unsaved changes to the *Process Settings*.

image::images/BDeploy_DnD_Applications.png[Drag & Drop Applications,align=center, width=480, link="images/BDeploy_DnD_Applications.png"]

The *Process Settings* dialog groups the parameters into categories, between which you can jump back and forth via btn:[Previous] and btn:[Next]. 

image::images/BDeploy_Process_Config.png[Process Parameter Configuration,align=center, width=480, link="images/BDeploy_Process_Config.png"]

Behind each parameter there is a small popup that can contain a short description, a *Default Value* and a button for resetting the parameter to the *Default Value*.

*Validation Issues* are displayed per group in the respective title. Only complete configurations can be accepted.

===== Optional Parameters

*Optional Parameters* can be selected for each group using the btn:[Manage Optional Parameters] dialog (available only if *Optional Parameters* are available) and then configured like other parameters.

image::images/BDeploy_Process_Optional_parameters.png[Manage Optional Parameter(s),align=center, width=480, link="images/BDeploy_Process_Optional_parameters.png"]
image::images/BDeploy_Process_Optional_configured.png[Configuring Optional Parameter(s), align=center, width=480, link="images/BDeploy_Process_Optional_configured.png"]

===== Custom Parameters

*Custom Parameters* can be maintained in the last parameter group. Because all *Parameters* must have a determined sequence, *Custom Parameters* must define a predecessor parameter after which they are put on the command line.

image::images/BDeploy_Process_Custom_Create.png[Create Custom Parameter,align=center, width=480, link="images/BDeploy_Process_Custom_Create.png"]
image::images/BDeploy_Process_Custom_Value.png[Configure Custom Parameter,align=center, width=480, link="images/BDeploy_Process_Custom_Value.png"]

===== Global Parameters

*Global Parameters* are valid for all *Processes* of an *Instance*. They are also configured in the *Process*, but changes are copied to all other processes that also use this parameter. *Global Parameters* are matched by their parameter UID, and marked with a small globe in the *Process Configuration* dialog.

===== Variables

*BDeploy* provides a mechanism for defining that a parameter should hold a dynamically computed value instead of a fixed one. The general syntax for variables is `{{TYPE:VARNAME:SUBVAR}}`. With that mechanism it is possible to define that a certain parameter holds different values for different operating systems or to refer to parameters defined in a different process. See <<_variable_expansion,Variable Expansion>> for more details.

===== Command Line Preview

A preview of the command that is executed to launch this process can be viewed by clicking on the btn:[Show Command Line Preview] button that is displayed at the right side of the *Parameter Settings* header. The preview is especially useful in case of custom parameters to ensure that they are added as expected in the correct order.

image::images/BDeploy_Process_Custom_Preview.png[Preview Command Line with Custom Parameter,align=center, width=480, link="images/BDeploy_Process_Custom_Preview.png"]

==== Configuration Files

The *Configuration Files* of all *Processes* of an *Instance* are maintained together in one dialog. It can be opened by clicking on the btn:[Configuration Files] button in the pull-down menu of the *Instance*. The initial set of *Configuration Files* is derived from the default set delivered with the product, see <<_product_info_yaml,`product-info.yaml`>>.

image::images/BDeploy_CfgFiles_Browser.png[Configuration File Browser,align=center,width=480,link="images/BDeploy_CfgFiles_Browser.png"]

The integrated editor provides syntax highlighting and rudimentary syntax checking for some basic file types (yaml, json, xml). Displayed problems are only to be seen as help and never interfere with the process, e.g. by preventing the saving of a file.

image::images/BDeploy_CfgFile_New.png[Create New Configuration File,align=center,width=480,link="images/BDeploy_CfgFile_New.png"]
image::images/BDeploy_CfgFiles_Save.png[Modified Configuration Files,align=center,width=480,link="images/BDeploy_CfgFiles_Save.png"]

[NOTE]
Changes done in configuration files must be *Saved* and they result in a new *Instance Version* that must be *Installed* and *Activated* so that the changes have an impact. 

==== Product Configuration

*Instances* are based on a *Product Version*. While the *Product* of the *Instance* cannot be changed afterwards, the *Version* can be chosen from the available *Product Versions* (upgrade to a newer version / downgrade to an older version). 


If there's a newer *Product Version* available (newer than the one that is configured for the latest *Instance Version*), a notification is shown. Clicking on the notification opens the *Product Version* sidebar. The same sidebar can also be opened opened by clicking on the btn:[Change Product Version] button in the pull-down menu of the *Instance*. If the menu entry is disabled verify that the latest *Instance Version* is selected.

image::images/BDeploy_Product_Change.png[Change Current Product Tag,align=center,width=480,link="images/BDeploy_Product_Change.png"]

The btn:[Info] Popup provides a list of all Labels on that *Product* version.

Changing the version can be done by clicking on the btn:[Upgrade] or btn:[Downgrade] button displayed at the right side of the product version card. Selecting another product version will automatically close the *Product Version* sidebar. The *Instance Version* sidebar is displayed and a new locally modified version has been created. 

image::images/BDeploy_Product_Upgrade_Local_Changes.png[Successful Product Tag Change,align=center,width=480,link="images/BDeploy_Product_Upgrade_Local_Changes.png"]

[NOTE]
All *Applications* are marked as modified as they are now based on a different *Product Version*.

Changing the *Product Version* can result in validation issues and automated adjustment of parameters. *Product Versions* can contain different *Applications*, so that with the change of the *Product Version* e.g. a previously configured *Application* must be deleted because it has been removed from the product. If parameters definitions are changed, validation errors may occur which must be corrected before saving (e.g. new mandatory parameters).

image::images/BDeploy_Product_Downgrade_Missing_Apps.png[Validation Issues After Product Tag Change,align=center,width=480,link="images/BDeploy_Product_Downgrade_Missing_Apps.png"]

==== Export/Import of Instance Versions

*Instance Versions* can be exported and imported. For the export, select the desired *Instance Version* and start the export in the pull-down menu with the action btn:[Export...].

The action btn:[Import Instance Version...] in the *Instance Version* pulldown menu imports a new *Instance Version*. The import data is compared with the existing *Instance* data before a new *Instance Version* is created.

[NOTE]
Only process configuration is imported to existing instances, the instance configuration (target master URI, name, description, purpose) are left intact.

==== Data Files

The *Data Files* Browser provides access to the server side data directory. Files can be downloaded or opened in the UI. When opened in place, the btn:[Follow] toggle allows to grab new output as it is written on the server.

image::images/BDeploy_DataFiles_Browser.png[Data File Browser,{thumbnail},role="thumb",link="images/BDeploy_DataFiles_Browser.png"]
image::images/BDeploy_DataFiles_Show.png[Show Data File,{thumbnail},role="thumb",link="images/BDeploy_DataFiles_Show.png"]


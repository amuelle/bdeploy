ext.installRetype = { task -> 
    configure(task) {
        group = BasePlugin.BUILD_GROUP
        if (!org.gradle.internal.os.OperatingSystem.current().isWindows()) {
            commandLine (["npm", "install", "retypeapp"])
        } else {
            commandLine (["npm.cmd", "install", "retypeapp"])
        }
    }
}

ext.buildRetype = { task ->
    configure(task) {
        group = BasePlugin.BUILD_GROUP
	    if (!org.gradle.internal.os.OperatingSystem.current().isWindows()) {
	        commandLine (["npx", "retypeapp", "build"])
	    } else {
	        commandLine (["npx.cmd", "retypeapp", "build"])
	    }
    }
}

task retypeDevDoc(type: Exec) { t ->
    workingDir './retypedev'
    inputs.dir './retypedev'
    outputs.dir "${buildDir}/docs/dev"
    installRetype(t)
    buildRetype(t)
}

task retypeUserDoc(type: Exec) { t ->
    workingDir './retypeuser'
    inputs.dir './retypeuser'
    outputs.dir "${buildDir}/docs/user"
    installRetype(t)
    buildRetype(t)
}

task build {
   // dummy
}

build.dependsOn retypeDevDoc
build.dependsOn retypeUserDoc
